{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"/>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/ac42c3b1f7.js" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fertilizers.com</title>
    <link rel="stylesheet" href="/static/products.css">
    <link rel="icon" href="/static/logo test.png">
    <script src="https://kit.fontawesome.com/ac42c3b1f7.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css"> 
</head>
<body>
    <nav class="main-navbar">
        <div class="logo-container">
            <a href="/products/"><img src="/static/logo test.png" class="imagelogo" alt="logo"></a>
            <span class="logo">Fertilizers.com</span>
        </div>
        
        <div class="menu-icon" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    
        <ul class="main-nav-links">
            <li><a href="/about/">About</a></li>
            <li><a href="/items/">Products</a></li>
            <li><a href="#categories">Categories</a></li>
            <li><a href="/contactus/">Contact</a></li>
            <li><a href="https://www.facebook.com/"><i class="fa-brands fa-facebook"></i></a></li>
            <li><a href="https://www.instagram.com/"><i class="fa-brands fa-instagram"></i></a></li>
            <li><a href="https://twitter.com/?lang=en"><i class="fa-brands fa-twitter"></i></a></li>
        </ul>
    </nav>
   
    <div class="mobile-sidebar" id="mobileSidebar">
        <ul class="sidebar-links">
            <li><a href="/about/"><i class="fa-solid fa-address-card"></i>  About</a></li>
            <li><a href="/dashboard/"><i class="fa-solid fa-circle-user"></i> Dashboard</a></li>
            <li class="has-submenu">
                <a href="#categories"><i class="fa-solid fa-list"></i> Categories <i class="fa-solid fa-caret-down"></i></a>
                <ul class="submenu">
                    <li><a href="/organic/">Organic</a></li>
                    <li><a href="/inorganic/">Inorganic</a></li>
                    <li><a href="/bio/">Bio</a></li>
                    <li><a href="/liquid/">Liquid</a></li>
                </ul>
            </li>
            <li><a href="/orders"><i class="fa-solid fa-cart-flatbed"></i> My Orders</a></li>
            <li><a href="/contactus"><i class="fa-solid fa-square-phone"></i> Contact</a></li>
            <li><a href="https://www.facebook.com/"><i class="fa-brands fa-facebook"></i> Facebook</a></li>
            <li><a href="https://www.instagram.com/"><i class="fa-brands fa-instagram"></i> Instagram</a></li>
            <li><a href="https://twitter.com/?lang=en"><i class="fa-brands fa-twitter"></i> Twitter</a></li>
            <li><a href="/wishlist/"><i class="fa fa-heart"></i> Wishlist (<span id="wishlist-count">0</span>)</a></li>
            <li><a href="/cart/"><i class="fa fa-shopping-cart"></i> Cart (<span class="cart-count">0</span>)</a></li>
        
            <li>
                {% if request.user.is_authenticated %}
                    <a href="{% url 'logout' %}">
                {% endif %}
                <button type="submit" class="logout">Logout</button></a>
            </li>
        </ul>
    </div>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    <!--Sub navigation_bar-->
    <div class="sub-navbar">
        <form method="GET" class="search-container">
            <input type="search" placeholder="Search here..." name="p_title" class="search-input">
            <button class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>
        <ul class="sub-nav-icons">
            <li class="dropdown">
                <a href="/dashboard/" class="user-dropdown"><i class="fa fa-user"></i> Profile</a>
                <ul class="dropdown-menu">
                    <li><a href="/dashboard/">{{user.username}}</a></li>
                    <li><a href="/myorders/">Orders</a></li>
                    <li><a href="/wishlist/"><i class="fa fa-heart"></i>Wishlist (<span id="wishlist-count">0</span>)</a></li>
                    <li><a href="/cart/"><i class="fa fa-shopping-cart"></i>Cart (<span class="cart-count">0</span>)</a></li>
                    <li>
                        {% if request.user.is_authenticated %}
                        <a href="{% url 'logout' %}">Logout</a>
                        {% endif %}
                    </li>
                </ul>
            </li>
            <li><a href="/wishlist/"><i class="fa fa-heart"></i> Wishlist (<span id="wishlist-count">0</span>)</a></li>
            <li><a href="/cart/"><i class="fa fa-shopping-cart"></i>Cart (<span class="cart-count">0</span>)</a></li>
        </ul>
    </div>
    <!-- Mobile Sidebar -->
    <div class="mobile-sidebar" id="mobileSidebar">
        <ul class="sidebar-links">
            <li><a href="/about/">About</a></li>
            <li><a href="/dashboard/"><i class="fa-solid fa-circle-user"></i> Dashboard</a></li>
            <li><a href="/contactus/"><i class="fa-solid fa-phone"></i> Contact</a></li>
            <li>
                {% if request.user.is_authenticated %}
                <a href="{% url 'logout' %}">Logout</a>
                {% endif %}
            </li>
        </ul>
    </div>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    <script>
        function toggleSidebar() {
           const sidebar = document.getElementById("mobileSidebar");
           const overlay = document.getElementById("overlay");
           const isActive = sidebar.classList.contains("active");
        
           sidebar.classList.toggle("active", !isActive);
           overlay.classList.toggle("active", !isActive);
        }
        
        document.querySelectorAll('.has-submenu > a').forEach(menu => {
           menu.addEventListener('click', function (e) {
               e.preventDefault(); 
               this.parentElement.classList.toggle('active');
           });
        });
        
        const sizeButtons = document.querySelectorAll('.size-options button');
        sizeButtons.forEach(button => {
           button.addEventListener('click', () => {
               sizeButtons.forEach(btn => btn.classList.remove('selected'));
               button.classList.add('selected');
           });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const currentUser = "{{ request.user.username }}";
            const wishlistKey = `wishlist_items_${currentUser}`;
            let wishlist = JSON.parse(localStorage.getItem(wishlistKey)) || [];
            updateWishlistCount();
            document.querySelectorAll(".favorite-heart").forEach(heartButton => {
                const productCard = heartButton.closest(".product-card");
                const product = extractProductData(productCard);

                heartButton.addEventListener("click", function() {
                    if (isInWishlist(product.details_slug)) {
                        removeFromWishlist(product.details_slug);
                        heartButton.classList.remove("favorited");
                        alert("Removed from Wishlist");
                    } else {
                        addToWishlist(product);
                        heartButton.classList.add("favorited");
                        alert("Added to Wishlist");
                    }
                    updateWishlistCount();
                });

                if (isInWishlist(product.details_slug)) {
                    heartButton.classList.add("favorited");
                }
            });
            function extractProductData(card) {
                return {
                    image_url: card.querySelector(".product-image").src,
                    product_name: card.querySelector(".product-name").textContent,
                    product_brand: card.querySelector(".product-brand").textContent.replace("Brand:", "").trim(),
                    price_inr: card.querySelector(".product-price strike")?.textContent.replace("₹", "") || "",
                    discount_price: card.querySelector(".product-price b")?.textContent.replace("₹", "") || "",
                    details_slug: card.querySelector("a").getAttribute("href").split("/").pop(),
                };
            }
            function addToWishlist(product) {
                wishlist.push(product);
                localStorage.setItem(wishlistKey, JSON.stringify(wishlist));
            }
            function removeFromWishlist(slug) {
                wishlist = wishlist.filter(item => item.details_slug !== slug);
                localStorage.setItem(wishlistKey, JSON.stringify(wishlist));
            }
            function isInWishlist(slug) {
                return wishlist.some(item => item.details_slug === slug);
            }
            function updateWishlistCount() {
                document.querySelectorAll("#wishlist-count").forEach(el => el.textContent = wishlist.length);
            }
        });
        document.addEventListener("DOMContentLoaded", function() {
            const currentUser = "{{ request.user.username }}";
            const cartKey = `cart_${currentUser}`;
            let cart = JSON.parse(localStorage.getItem(cartKey)) || [];
            updateCartCount();
            function updateCartCount() {
                document.querySelectorAll(".cart-count").forEach(el => el.textContent = cart.length);
            }
            window.updateCartCount = updateCartCount;
        });
    </script>  